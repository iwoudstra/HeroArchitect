@page "/"
@using HeroArchitect.Web.Domain.State
@inject NavigationManager navigationManager
@inject IStateContainer stateContainer
@inject Session session

<PageTitle>Welcome to the game</PageTitle>

<h1>Hello @session.Name, welcome to Hero Architect, join or create a lobby</h1>

<br />
<label for="username">Name:</label>
<input id="username" type="text" @bind-value="session.Name" />


<table>
	<thead>
		<tr>
			<th style="min-width: 100px;">Name</th>
			<th style="min-width: 100px;">Players</th>
			<th style="min-width: 100px;">Max players</th>
			<th style="min-width: 100px;"></th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td><input type="text" @bind-value="newLobbyName" /></td>
			<td></td>
			<td><input type="number" @bind-value="newMaxPlayers" /></td>
			<td><button @onclick="@(e => CreateLobby())">Create Lobby</button></td>
		</tr>
		@foreach (var lobby in stateContainer.Lobbies)
		{
			<tr>
				<td>@lobby.Name</td>
				<td>@lobby.Users.Count</td>
				<td>@lobby.MaxPlayers</td>
				<td><button @onclick="@(e => JoinLobby(lobby.Id))">Join Lobby</button></td>
			</tr>
		}
	</tbody>
</table>



@code
{
	private string newLobbyName = string.Empty;
	private int newMaxPlayers = 4;

	private void CreateLobby()
	{
		var lobby = stateContainer.CreateLobby(newLobbyName, newMaxPlayers).JoinLobby(new Domain.User(Guid.NewGuid(), "abc"));
		navigationManager.NavigateTo($"/Lobby/{lobby.Id}");
	}

	private void JoinLobby(Guid lobbyId)
	{
		stateContainer.JoinLobby(lobbyId, new Domain.User(Guid.NewGuid(), "Def"));
	}
}